<!DOCTYPE html>
<html>
  <head>
    <title>Flyway, migración de bases de datos</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content=', flyway, migration, database, java, maven' name='keywords'>
    <meta content='Ejemplo de migración de bases de datos para Java' name='description'>
    <link href='/assets/css/reset.css' rel='stylesheet' type='text/css'>
    <link href='/assets/css/style.css' media='screen' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='main'>
      <div id='header'>
        <div class='logo'>
          <a href='/'>&laquo; Miguel Triana - site</a>
        </div>
        <div id='nav'>
          <ul>
            <li><a href='/archives.html'>archives</a></li>
            <li><a href='/tags.html'>tags</a></li>
            <li><a href='/projects.html'>projects</a></li>
            <li><a href='/about.html'>about</a></li>
            <li><a href='/contact.html'>contact</a></li>
            <li>
              <a href='/atom.xml'>rss</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div id='content'>
        <div class='article'>
          <h1>
            Flyway, migración de bases de datos
          </h1>
          <div class='meta'>
            <ul class='tags'>
              <li>Apr 25, 2011</li>
              <li>
                &middot;
              </li>
              <li>
                <a href='/2011/04/25/ejemplo_flyway.html#disqus_thread'></a>
              </li>
              <li>&middot;</li>
              <li>
                <a class='tag' href='/tags/database/'>
                  database
                </a>
              </li>
              <li>
                <a class='tag' href='/tags/flyway/'>
                  flyway
                </a>
              </li>
              <li>
                <a class='tag' href='/tags/java/'>
                  java
                </a>
              </li>
              <li>
                <a class='tag' href='/tags/maven/'>
                  maven
                </a>
              </li>
              <li>
                <a class='tag' href='/tags/migration/'>
                  migration
                </a>
              </li>
            </ul>
          </div>
          <div class='body'>
            <p>Ejemplo de migración de bases de datos para Java usando <a href='http://code.google.com/p/flyway/' target='_blank'>Flyway</a> y <a href='http://maven.apache.org' target='_blank'>Maven</a></p>
            
            <ol>
            <li>Crear un projecto simple en Maven:
            <code>mvn archetype:create -DgroupId=com.example.db -DartifactId=db-project</code></li>
            <li>Adicionar el plug-in de flyway en el POM
            <code class="xml"><table class="CodeRay"><tr>&#x000A;<td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre><a href="#n1" name="n1">1</a>&#x000A;<a href="#n2" name="n2">2</a>&#x000A;<a href="#n3" name="n3">3</a>&#x000A;<a href="#n4" name="n4">4</a>&#x000A;<a href="#n5" name="n5">5</a>&#x000A;<a href="#n6" name="n6">6</a>&#x000A;<a href="#n7" name="n7">7</a>&#x000A;<a href="#n8" name="n8">8</a>&#x000A;<a href="#n9" name="n9">9</a>&#x000A;<strong><a href="#n10" name="n10">10</a></strong>&#x000A;<a href="#n11" name="n11">11</a>&#x000A;<a href="#n12" name="n12">12</a>&#x000A;<a href="#n13" name="n13">13</a>&#x000A;<a href="#n14" name="n14">14</a>&#x000A;<a href="#n15" name="n15">15</a>&#x000A;<a href="#n16" name="n16">16</a>&#x000A;<a href="#n17" name="n17">17</a>&#x000A;<a href="#n18" name="n18">18</a>&#x000A;<a href="#n19" name="n19">19</a>&#x000A;<strong><a href="#n20" name="n20">20</a></strong>&#x000A;<a href="#n21" name="n21">21</a>&#x000A;</pre></td>&#x000A;<td class="code"><pre><span style="color:#070">&lt;build&gt;</span>&#x000A;...&#x000A;<span style="color:#070">&lt;plugins&gt;</span>&#x000A; <span style="color:#070">&lt;plugin&gt;</span>&#x000A;   <span style="color:#070">&lt;groupId&gt;</span>com.googlecode.flyway<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070">&lt;artifactId&gt;</span>flyway-maven-plugin<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070">&lt;version&gt;</span>1.3.1<span style="color:#070">&lt;/version&gt;</span>&#x000A;   <span style="color:#070">&lt;configuration&gt;</span>&#x000A;     <span style="color:#070">&lt;driver&gt;</span>org.postgresql.Driver<span style="color:#070">&lt;/driver&gt;</span>&#x000A;     <span style="color:#070">&lt;url&gt;</span>jdbc:postgresql://localhost:5432/teste_migration<span style="color:#070">&lt;/url&gt;</span>&#x000A;     <span style="color:#070">&lt;user&gt;</span>postgres<span style="color:#070">&lt;/user&gt;</span>&#x000A;     <span style="color:#070">&lt;password&gt;</span>postgres<span style="color:#070">&lt;/password&gt;</span>&#x000A;     <span style="color:#070">&lt;table&gt;</span>schema_history<span style="color:#070">&lt;/table&gt;</span>&#x000A;     <span style="color:#070">&lt;initialVersion&gt;</span>1.0<span style="color:#070">&lt;/initialVersion&gt;</span>&#x000A;     <span style="color:#070">&lt;initialDescription&gt;</span>Base Migration<span style="color:#070">&lt;/initialDescription&gt;</span>&#x000A;     <span style="color:#070">&lt;baseDir&gt;</span>db/migration<span style="color:#070">&lt;/baseDir&gt;</span>&#x000A;   <span style="color:#070">&lt;/configuration&gt;</span>&#x000A; <span style="color:#070">&lt;/plugin&gt;</span>&#x000A;<span style="color:#070">&lt;/plugins&gt;</span>&#x000A;...&#x000A;<span style="color:#070">&lt;/build&gt;</span>&#x000A;</pre></td>&#x000A;</tr></table></code></li>
            <li>Adicionar la dependencia del driver de postgres
            <code class="xml"><table class="CodeRay"><tr>&#x000A;<td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre><a href="#n1" name="n1">1</a>&#x000A;<a href="#n2" name="n2">2</a>&#x000A;<a href="#n3" name="n3">3</a>&#x000A;<a href="#n4" name="n4">4</a>&#x000A;<a href="#n5" name="n5">5</a>&#x000A;</pre></td>&#x000A;<td class="code"><pre><span style="color:#070">&lt;dependency&gt;</span>&#x000A;<span style="color:#070">&lt;groupId&gt;</span>postgresql<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;<span style="color:#070">&lt;artifactId&gt;</span>postgresql<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;<span style="color:#070">&lt;version&gt;</span>8.3-603.jdbc3<span style="color:#070">&lt;/version&gt;</span>&#x000A;<span style="color:#070">&lt;/dependency&gt;</span>&#x000A;</pre></td>&#x000A;</tr></table></code></li>
            <li>Crear la tabla de versiones: <code>mvn flyway:init</code></li>
            <li>Crear el directorio de migraciones: <code>mkdir src/main/resources/db/migration -p</code> . Esta es la ubicación predeterminada</li>
            <li>Crear la primera migración: crea el archivo V1.1.first_table.sql en el folder anterior con el siguiente contenido:
            <code class="sql"><table class="CodeRay"><tr>&#x000A;<td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre><a href="#n1" name="n1">1</a>&#x000A;<a href="#n2" name="n2">2</a>&#x000A;<a href="#n3" name="n3">3</a>&#x000A;<a href="#n4" name="n4">4</a>&#x000A;<a href="#n5" name="n5">5</a>&#x000A;</pre></td>&#x000A;<td class="code"><pre>&#x000A;<span style="color:#B06;font-weight:bold">CREATE</span> <span style="color:#339;font-weight:bold">TABLE</span> test_user (&#x000A;name <span style="color:#0a5;font-weight:bold">VARCHAR</span>(<span style="color:#00D">25</span>) <span style="color:#080;font-weight:bold">NOT</span> <span style="color:#069">NULL</span>,&#x000A;<span style="color:#088;font-weight:bold">PRIMARY</span> <span style="color:#339;font-weight:bold">KEY</span>(name)&#x000A;);&#x000A;</pre></td>&#x000A;</tr></table></code></li>
            <li>Migrar la base de datos: <code>mvn install flyway:migrate</code></li>
            <li><p>Listo!, para ver el estado de la base de datos ejecutar: <code>mvn flyway:status</code>. Maven va a presentar el siguiente resultado:</p>
            
            <pre><code> [INFO] ------------------------------------------------------------------------&#x000A; [INFO] [flyway:status {execution: default-cli}]&#x000A; [INFO] +-------------+------------------------+---------------------+---------+&#x000A; [INFO] | Version     | Description            | Installed on        | State   |&#x000A; [INFO] +-------------+------------------------+---------------------+---------+&#x000A; [INFO] | 1.1         | initial tables         | 2011-04-25 11:07:18 | SUCCESS |&#x000A; [INFO] +-------------+------------------------+---------------------+---------+&#x000A;</code></pre></li>
            <li>Para las siguientes migraciones repetir pasos 6 y 7, siguiendo el patrÓn <em>Vnumero_descripcion.sql</em>.</li>
            </ol>
          </div>
        </div>
        <div id='other-articles'>
          <div class='older'>
            <ul>
              <li>
                <h3>
                  <a href='/2011/04/24/intro_android.html' title='Introduciendo Android, el SO para móviles de Google'>
                    &laquo; Introducción a Android
                  </a>
                </h3>
              </li>
              <li>
                <h3>
                  <a href='/2011/04/04/tips_mobile.html' title='Tips para desarrollo de aplicaciones móviles.'>
                    &laquo; Desarrollo de aplicaciones móviles
                  </a>
                </h3>
              </li>
              <li>
                <h3>
                  <a href='/2010/02/25/captura_audio_javame.html' title='Este es un ejemplo para la captura de audio con J2ME'>
                    &laquo; Captura de audio para Java ME
                  </a>
                </h3>
              </li>
            </ul>
          </div>
          <div class='newer'>
            <ul>
              <li>
                <h3>
                  <a href='/2011/04/27/ejemplo_c5_db.html' title='Ejemplo de migración de bases de datos para Java'>
                    c5-db-migration, migración de bases de datos &raquo;
                  </a>
                </h3>
              </li>
              <li>
                <h3>
                  <a href='/tips/siteadmin.html' title='Comandos utiles para la administración de mi página web estática'>
                    Administración de sitio web estático &raquo;
                  </a>
                </h3>
              </li>
              <li>
                <h3>
                  <a href='/tips/cmds.html' title='Commands reference for develoment with Maven, Git, Ant, SVN, CVS, VirtualBox, etc.'>
                    Commands summary &raquo;
                  </a>
                </h3>
              </li>
            </ul>
          </div>
        </div>
        <div class='clear'></div>
        <div class='comments'>
          <div id='disqus_thread'></div>
          <script src='http://disqus.com/forums/emiguelwebpage/embed.js' type='text/javascript'></script>
          <noscript>
            <a href='http://disqus.com/forums/emiguelwebpage/?url=ref'>
              View the discussion thread
            </a>
          </noscript>
        </div>
        <!-- / disqus adds too much visual crap -->
        <style type='text/css'>
          <style>
            .dsq-dc-logo {
              display: none !important; }
          </style>
        </style>
      </div>
      <div class='clear'></div>
    </div>
    <script>
      (function() {
        var links = document.getElementsByTagName('a');
        var query = '?';
        for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
        }
        document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/emiguelwebpage/get_num_replies.js' + query + '"></' + 'script>');
      })();
    </script>
    <script>
      var pkBaseURL = (("https:" == document.location.protocol) ? "https://sourceforge.net/userapps/piwik/emigueltriana/" : "http://sourceforge.net/userapps/piwik/emigueltriana/");
      document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script>
      try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
      } catch( err ) {}
    </script>
    <noscript>
      <p>
        <img alt='' src='http://sourceforge.net/userapps/piwik/emigueltriana/piwik.php?idsite=1' style='border:0'>
      </p>
    </noscript>
  </body>
</html>
